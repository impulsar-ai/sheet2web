<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Gallery</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.2/papaparse.min.js"></script>
    <style>
        .aspect-ratio-16-9 {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
        }

        .aspect-ratio-16-9 img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .responsive-iframe-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
        }

        .responsive-iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
    </style>
</head>

<body>
    <div id="app" class="p-5">
        <div class="mb-5">
            <span v-for="(count, facet) in facetCounts" :key="facet"
                :class="{'bg-blue-500 text-white': activeFacets[facet], 'bg-gray-200 text-gray-700': !activeFacets[facet]}"
                class="inline-block rounded-full px-3 py-1 text-sm font-semibold mr-2 mb-2 cursor-pointer"
                @click="toggleFacet(facet)">
                {{ facet }} ({{ count }})
            </span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div v-for="video in filteredVideos" :key="video.VideoID"
                class="max-w-sm rounded overflow-hidden shadow-lg">
                <div class="aspect-ratio-16-9">
                    <img :src="video.ThumbnailURL" alt="Thumbnail" class="cursor-pointer" @click="showModal(video)">
                </div>
                <div class="px-6 py-4">
                    <div class="font-bold text-xl mb-2">
                        <a href="#" class="text-blue-700 hover:text-blue-900" @click.prevent="showModal(video)">
                            {{ video.Title }}
                        </a>
                    </div>
                    <p>{{ trimDescription(video.Description) }}</p>
                    <div class="mt-2">
                        <span
                            class="inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2"
                            v-for="facet in parseFacets(video.Facets, video.Tags)" :key="facet">{{ facet }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="selectedVideo" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full"
            @click.self="selectedVideo = null">
            <div class="relative top-20 mx-auto p-5 border w-3/4 shadow-lg rounded-md bg-white">
                <div class="responsive-iframe-container">
                    <iframe :src="selectedVideo.IframeURL" allowfullscreen></iframe>
                </div>
                <div class="mt-3 text-center">
                    <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                        @click="selectedVideo = null">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                videos: [],
                selectedVideo: null,
                activeFacets: {}
            },
            computed: {
                facetCounts() {
                    const counts = {};
                    this.videos.forEach(video => {
                        const facets = this.parseFacets(video.Facets, video.Tags);
                        facets.forEach(facet => {
                            if (!counts[facet]) {
                                counts[facet] = 0;
                            }
                            counts[facet]++;
                        });
                    });
                    return counts;
                },
                filteredVideos() {
                    if (Object.keys(this.activeFacets).length === 0) {
                        return this.videos;
                    }
                    return this.videos.filter(video => {
                        const facets = this.parseFacets(video.Facets, video.Tags);
                        return facets.some(facet => this.activeFacets[facet]);
                    });
                }
            },
            methods: {
                showModal(video) {
                    this.selectedVideo = video;
                },
                trimDescription(description) {
                    return description.length > 200 ? description.substr(0, 200) + '...' : description;
                },
                parseFacets(facetsString, tagsString) {
                    let facets = facetsString;
                    if (!facets || facets.trim() === '') {
                        facets = tagsString;
                    }
                    return facets ? facets.split(',').map(facet => facet.trim()) : [];
                },
                toggleFacet(facet) {
                    if (this.activeFacets[facet]) {
                        Vue.delete(this.activeFacets, facet);
                    } else {
                        Vue.set(this.activeFacets, facet, true);
                    }
                }
            },
            mounted() {
                fetch('sheet_url.txt')
                    .then(response => response.text())
                    .then(url => {
                        fetch(url.trim()) // Asegura que no hay espacios en blanco alrededor de la URL
                            .then(response => response.text())
                            .then(csvData => {
                                Papa.parse(csvData, {
                                    header: true,
                                    skipEmptyLines: true,
                                    complete: (results) => {
                                        this.videos = results.data;
                                    }
                                });
                            });
                    });
            }
        });
    </script>
</body>

</html>